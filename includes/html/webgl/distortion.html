<img data-src="/img/distortion.jpg" id="displacementMap" style="display: none" />
<canvas id="distortion"></canvas>

<include src="webgl/distortion.css" />
<include src="webgl/distortion.js" />
<script type="text/javascript">
	function updateDistortionMode(mode) {

		if (window.distortionScroller.mode != mode) {
			switch (mode) {
				case 0:
					window.distortionScroller.changeMode(
						0,
						[1, 1, 1],
						0,
						0.93,
						0.95
					);
					introSection.classList.toggle("intro", true);
					introSection.classList.toggle("outro", false);
					break;
				case 1:
				const contactBounds = contactSection.getBoundingClientRect();
				window.distortionScroller.changeMode(
					1,
					[0.06666666666666667, 0.06666666666666667, 0.06666666666666667],
					window.scrollY + contactBounds.top - windowHeight * 0.75,
					0.93,
					0.95
				);
				introSection.classList.toggle("intro", false);
				introSection.classList.toggle("outro", true);
					break;
			}
		}
	}

	window.initDistortion = function () {
		window.distortionScroller = new WebGLDistortionScroller({
			displacement: document.getElementById("displacementMap"),
			onFirstRender: function () {
				switch (window.distortionScroller.mode) {
					case 0:
						document.body.style.background = `#111`;
						break;
					case 1:
						document.body.style.background = `#fff`;
						break;
				}
				highPerformanceScroll();
			},
			onPause: function () {
				console.log("PAUSED DISTORTION!");
				// Start the scroll listener for when we need to unpause the animation
			}
		});
		window.distortionScroller.init();

		if (window.distortionScroller.mode != 1) updateDistortionMode(0);
	}
</script>